<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>typed-struct</title><meta name="description" content="Documentation for typed-struct"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">typed-struct</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>typed-struct</h2></div><div class="tsd-panel tsd-typography"><a id="md:typed-struct" class="tsd-anchor"></a><h1 class="tsd-anchor-link">typed-struct<a href="#md:typed-struct" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>A JavaScript utility library (written in TypeScript) for creating objects and classes that store
their properties in a buffer for serialization/deserialization
similar to structures in C.</p>
<p><a href="https://www.npmjs.com/package/typed-struct"><img src="https://img.shields.io/npm/v/typed-struct.svg" alt="NPM version"></a>
<a href="https://www.npmjs.com/package/typed-struct"><img src="https://img.shields.io/npm/dm/typed-struct.svg" alt="NPM version"></a>
<a href="https://codecov.io/gh/sarakusha/typed-struct"><img src="https://codecov.io/gh/sarakusha/typed-struct/branch/main/graph/badge.svg?token=6F26I7FO73" alt="codecov"></a>
<a href="https://circleci.com/gh/sarakusha/typed-struct"><img src="https://circleci.com/gh/sarakusha/typed-struct.svg?style=shield" alt="CircleCI"></a></p>
<a id="md:getting-started" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Getting started<a href="#md:getting-started" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Using npm:</p>
<pre><code class="bash"><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">typed-struct</span>
</code><button type="button">Copy</button></pre>

<p>or yarn:</p>
<pre><code class="bash"><span class="hl-0">$</span><span class="hl-1"> </span><span class="hl-2">yarn</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">typed-struct</span>
</code><button type="button">Copy</button></pre>

<p>To use the module in a browser environment, add the <a href="https://github.com/feross/buffer">buffer</a> package to the dependencies.</p>
<pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">buffer</span>
</code><button type="button">Copy</button></pre>

<a id="md:features" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Features<a href="#md:features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The following types are supported:</p>
<ul>
<li>Integer (1, 2, 4, 8 bytes)</li>
<li>Boolean (1, 2, 4 bytes)</li>
<li>Float (4 bytes)</li>
<li>Double (8 bytes)</li>
<li>Bit fields (1, 2, 4 bytes)</li>
<li>Binary-decoded decimal (1 byte)</li>
<li>Buffer</li>
<li>String (with <a href="https://github.com/ashtuchkin/iconv-lite">iconv-lite</a> encodings)</li>
<li>Custom type (requires custom getter/setter)</li>
<li>Works in node.js and the browser (requires <a href="https://github.com/feross/buffer">buffer</a> for the browser)</li>
</ul>
<p>Fixed values, endianness, nested types and arrays are also supported.</p>
<p>The generated structures will be strongly typed,
which will provide better documentation and allow TypeScript
to validate that your code is working correctly.</p>
<a id="md:api" class="tsd-anchor"></a><h2 class="tsd-anchor-link"><a href="https://sarakusha.github.io/typed-struct/">API</a><a href="#md:api" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Examples<a href="#md:examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:create-a-data-structure-by-chaining-the-appropriate-method-calls" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Create a data structure by chaining the appropriate method calls<a href="#md:create-a-data-structure-by-chaining-the-appropriate-method-calls" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> { </span><span class="hl-4">Struct</span><span class="hl-1"> } = </span><span class="hl-0">require</span><span class="hl-1">(</span><span class="hl-2">&#39;typed-struct&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">// or</span><br/><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">Struct</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;typed-struct&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">MyStructure</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;MyStructure&#39;</span><span class="hl-1">) </span><span class="hl-5">// give a name to the constructor</span><br/><span class="hl-1">  .</span><span class="hl-0">Int8</span><span class="hl-1">(</span><span class="hl-2">&#39;foo&#39;</span><span class="hl-1">)        </span><span class="hl-5">// signed 8-bit integer field `foo`</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;bar&#39;</span><span class="hl-1">)    </span><span class="hl-5">// unsigned, little-endian 16-bit integer field `bar`</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();         </span><span class="hl-5">// create a constructor for the structure, called last</span><br/><br/><span class="hl-5">// You can use the compiled constructor as if you had made a class.</span><br/><span class="hl-5">// If you are using a typescript, you will also get</span><br/><span class="hl-5">// the exact type of the generated structure</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">item1</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">MyStructure</span><span class="hl-1">();      </span><span class="hl-5">// creates an instance</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">item1</span><span class="hl-1">.</span><span class="hl-7">constructor</span><span class="hl-1">.</span><span class="hl-7">name</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-2">&#39;MyStructure&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// This class has useful static properties and methods.</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">raw</span><span class="hl-1"> = </span><span class="hl-7">MyStructure</span><span class="hl-1">.</span><span class="hl-0">raw</span><span class="hl-1">(</span><span class="hl-7">item1</span><span class="hl-1">);   </span><span class="hl-5">// get the underlying buffer</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">MyStructure</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">3</span><span class="hl-1">); </span><span class="hl-5">// the minimum base size of the structure</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">raw</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-7">MyStructure</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Changing the properties of the structure</span><br/><span class="hl-5">// changes the underlying buffer</span><br/><span class="hl-7">item1</span><span class="hl-1">.</span><span class="hl-7">foo</span><span class="hl-1"> = </span><span class="hl-8">0x56</span><span class="hl-1">;</span><br/><span class="hl-7">item1</span><span class="hl-1">.</span><span class="hl-7">bar</span><span class="hl-1"> = </span><span class="hl-8">0x1234</span><span class="hl-1">;</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">raw</span><span class="hl-1">).</span><span class="hl-0">toEqual</span><span class="hl-1">(</span><span class="hl-7">Buffer</span><span class="hl-1">.</span><span class="hl-0">from</span><span class="hl-1">([</span><span class="hl-8">0x56</span><span class="hl-1">, </span><span class="hl-8">0x34</span><span class="hl-1">, </span><span class="hl-8">0x12</span><span class="hl-1">]))</span><br/><br/><span class="hl-5">// ... and vice versa</span><br/><span class="hl-7">raw</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">] = </span><span class="hl-8">0</span><span class="hl-1">;</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">item1</span><span class="hl-1">.</span><span class="hl-7">foo</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// deserialization</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">item2</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">MyStructure</span><span class="hl-1">([</span><span class="hl-8">0x11</span><span class="hl-1">, </span><span class="hl-8">0x22</span><span class="hl-1">, </span><span class="hl-8">0x33</span><span class="hl-1">]);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">item2</span><span class="hl-1">.</span><span class="hl-7">foo</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">0x11</span><span class="hl-1">);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">item2</span><span class="hl-1">.</span><span class="hl-7">bar</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">0x3322</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:typed-arrays" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Typed arrays<a href="#md:typed-arrays" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">Struct</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;typed-struct&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Foo</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Foo&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt16Array</span><span class="hl-1">(</span><span class="hl-2">&#39;items&#39;</span><span class="hl-1">, </span><span class="hl-8">10</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">foo</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Foo</span><span class="hl-1">();</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">foo</span><span class="hl-1">.</span><span class="hl-7">items</span><span class="hl-1">).</span><span class="hl-0">toHaveLength</span><span class="hl-1">(</span><span class="hl-8">10</span><span class="hl-1">);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">foo</span><span class="hl-1">.</span><span class="hl-7">items</span><span class="hl-1">).</span><span class="hl-0">toBeInstanceOf</span><span class="hl-1">(</span><span class="hl-7">Uint16Array</span><span class="hl-1">);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Foo</span><span class="hl-1">.</span><span class="hl-0">raw</span><span class="hl-1">(</span><span class="hl-7">foo</span><span class="hl-1">)).</span><span class="hl-0">toHaveLength</span><span class="hl-1">(</span><span class="hl-8">20</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// If the byte order in the system is different from that used in the data,</span><br/><span class="hl-5">// use `swap` method</span><br/><span class="hl-7">Foo</span><span class="hl-1">.</span><span class="hl-0">swap</span><span class="hl-1">(</span><span class="hl-7">foo</span><span class="hl-1">, </span><span class="hl-2">&#39;items&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// ...</span><br/><br/><span class="hl-5">// change back</span><br/><span class="hl-7">Foo</span><span class="hl-1">.</span><span class="hl-0">swap</span><span class="hl-1">(</span><span class="hl-7">foo</span><span class="hl-1">, </span><span class="hl-2">&#39;items&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:array-of-structures" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Array of structures<a href="#md:array-of-structures" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Using the structure <code>MyStructure</code> from the previous examples</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Baz</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Baz&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">StructArray</span><span class="hl-1">(</span><span class="hl-2">&#39;structs&#39;</span><span class="hl-1">, </span><span class="hl-7">MyStructure</span><span class="hl-1">, </span><span class="hl-8">10</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">baz</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Baz</span><span class="hl-1">();</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">baz</span><span class="hl-1">.</span><span class="hl-7">structs</span><span class="hl-1">).</span><span class="hl-0">toHaveLength</span><span class="hl-1">(</span><span class="hl-8">10</span><span class="hl-1">);</span><br/><span class="hl-7">baz</span><span class="hl-1">.</span><span class="hl-7">structs</span><span class="hl-1">[</span><span class="hl-8">3</span><span class="hl-1">].</span><span class="hl-7">foo</span><span class="hl-1"> = </span><span class="hl-8">123</span><span class="hl-1">;</span><br/><span class="hl-5">// but</span><br/><span class="hl-0">expect</span><span class="hl-1">(() </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">baz</span><span class="hl-1">.</span><span class="hl-7">struct</span><span class="hl-1">[</span><span class="hl-8">3</span><span class="hl-1">] = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">MyStructure</span><span class="hl-1">();</span><br/><span class="hl-1">}).</span><span class="hl-0">toThrow</span><span class="hl-1">(</span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">TypeError</span><span class="hl-1">(</span><span class="hl-2">&#39;Cannot assign to read only property &quot;3&quot;&#39;</span><span class="hl-1">))</span><br/><br/><span class="hl-0">expect</span><span class="hl-1">(() </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">baz</span><span class="hl-1">.</span><span class="hl-7">structs</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">MyStructure</span><span class="hl-1">());</span><br/><span class="hl-1">}).</span><span class="hl-0">toThrow</span><span class="hl-1">(</span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">TypedError</span><span class="hl-1">(</span><span class="hl-2">&#39;Cannot add property 10, object is not extensible&#39;</span><span class="hl-1">));</span><br/>
</code><button type="button">Copy</button></pre>

<a id="md:nested-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Nested types<a href="#md:nested-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Using the structure <code>MyStructure</code> from the previous examples</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Bat</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Bat&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Float64LE</span><span class="hl-1">(</span><span class="hl-2">&#39;baz&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;quux&#39;</span><span class="hl-1">, </span><span class="hl-7">MyStructure</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">bat</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Bat</span><span class="hl-1">();</span><br/><span class="hl-7">bat</span><span class="hl-1">.</span><span class="hl-7">quux</span><span class="hl-1">.</span><span class="hl-7">foo</span><span class="hl-1"> = </span><span class="hl-8">123</span><span class="hl-1">;</span><br/><span class="hl-7">bat</span><span class="hl-1">.</span><span class="hl-7">quux</span><span class="hl-1">.</span><span class="hl-7">bar</span><span class="hl-1"> = </span><span class="hl-8">82345</span><span class="hl-1">;</span><br/><span class="hl-7">bat</span><span class="hl-1">.</span><span class="hl-7">baz</span><span class="hl-1"> = </span><span class="hl-8">3.14</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Xyz</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Xyz&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;bat&#39;</span><span class="hl-1">, </span><span class="hl-7">Bat</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">xyz</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Xyz</span><span class="hl-1">();</span><br/><span class="hl-7">xyz</span><span class="hl-1">.</span><span class="hl-7">bat</span><span class="hl-1">.</span><span class="hl-7">quux</span><span class="hl-1">.</span><span class="hl-7">foo</span><span class="hl-1"> = </span><span class="hl-8">123</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// but assignment to structure field is not allowed</span><br/><span class="hl-0">expect</span><span class="hl-1">(() </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">xyz</span><span class="hl-1">.</span><span class="hl-7">bat</span><span class="hl-1"> = </span><span class="hl-7">bat</span><span class="hl-1">;</span><br/><span class="hl-1">}).</span><span class="hl-0">toThrow</span><span class="hl-1">(</span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">TypeError</span><span class="hl-1">(</span><span class="hl-2">&#39;Cannot assign to read only property bat&#39;</span><span class="hl-1">))</span>
</code><button type="button">Copy</button></pre>

<a id="md:unions" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Unions<a href="#md:unions" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Word</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Word&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;value&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">// We take a step back or two bytes back, which the previous field takes up</span><br/><span class="hl-1">  </span><span class="hl-5">// you can also use `seek` method with a negative argument</span><br/><span class="hl-1">  .</span><span class="hl-0">back</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt8</span><span class="hl-1">(</span><span class="hl-2">&#39;low&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt8</span><span class="hl-1">(</span><span class="hl-2">&#39;high&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">word</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Word</span><span class="hl-1">();</span><br/><span class="hl-7">word</span><span class="hl-1">.</span><span class="hl-7">value</span><span class="hl-1"> = </span><span class="hl-8">0x1234</span><span class="hl-1">;</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">word</span><span class="hl-1">.</span><span class="hl-7">low</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">0x34</span><span class="hl-1">);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">word</span><span class="hl-1">.</span><span class="hl-7">high</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">0x12</span><span class="hl-1">);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Word</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">2</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:custom-types" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Custom types<a href="#md:custom-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">BirthCertificate</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;BirthCertificate&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Custom</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;birthday&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-8">8</span><span class="hl-1">, </span><span class="hl-5">// size</span><br/><span class="hl-1">    </span><span class="hl-5">// getter, must return property value or `undefined` for unknown type</span><br/><span class="hl-1">    (</span><span class="hl-7">type</span><span class="hl-1">, </span><span class="hl-7">buf</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-7">buf</span><span class="hl-1">.</span><span class="hl-0">readDoubleLE</span><span class="hl-1">() * </span><span class="hl-8">1000</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-5">// setter, must return `false` for unknown type or `true` if everything is ok</span><br/><span class="hl-1">    (</span><span class="hl-7">type</span><span class="hl-1">, </span><span class="hl-7">buf</span><span class="hl-1">, </span><span class="hl-7">value</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-7">buf</span><span class="hl-1">.</span><span class="hl-0">writeDoubleLE</span><span class="hl-1">(</span><span class="hl-7">value</span><span class="hl-1">.</span><span class="hl-0">getTime</span><span class="hl-1">() / </span><span class="hl-8">1000</span><span class="hl-1">) &gt; </span><span class="hl-8">0</span><br/><span class="hl-1">  )</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">BirthCertificate</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">8</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">cert</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">BirthCertificate</span><span class="hl-1">();</span><br/><span class="hl-7">cert</span><span class="hl-1">.</span><span class="hl-7">birthday</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-8">1973</span><span class="hl-1">, </span><span class="hl-8">6</span><span class="hl-1">, </span><span class="hl-8">15</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:aliases" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Aliases<a href="#md:aliases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Using the structure <code>BirthCertificate</code> from the previous example.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Twins</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Twins&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">// `John` and `Jimmy` properties are equivalent</span><br/><span class="hl-1">  .</span><span class="hl-0">Struct</span><span class="hl-1">([</span><span class="hl-2">&#39;John&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;Jimmy&#39;</span><span class="hl-1">], </span><span class="hl-7">BirthCertificate</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Twins</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">8</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">twins</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Twins</span><span class="hl-1">();</span><br/><span class="hl-7">twins</span><span class="hl-1">.</span><span class="hl-7">John</span><span class="hl-1">.</span><span class="hl-7">birthday</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(</span><span class="hl-8">1973</span><span class="hl-1">, </span><span class="hl-8">6</span><span class="hl-1">, </span><span class="hl-8">15</span><span class="hl-1">);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">twins</span><span class="hl-1">.</span><span class="hl-7">Jimmy</span><span class="hl-1">.</span><span class="hl-7">birthday</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-7">twins</span><span class="hl-1">.</span><span class="hl-7">John</span><span class="hl-1">.</span><span class="hl-7">birthday</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:fixed-values" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Fixed values<a href="#md:fixed-values" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Request</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Request&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt32BE</span><span class="hl-1">(</span><span class="hl-2">&#39;header&#39;</span><span class="hl-1">, </span><span class="hl-8">0xDEADBEEF</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Buffer</span><span class="hl-1">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-1">, </span><span class="hl-8">16</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Request</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// `header` property is initialized in the constructor</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">header</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">0xDEADBEEF</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Assigning a value other than the specified one is not allowed</span><br/><span class="hl-0">expect</span><span class="hl-1">(() </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// eslint or IDE will also indicate an error</span><br/><span class="hl-1">  </span><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">header</span><span class="hl-1"> = </span><span class="hl-8">0xDEADC0DE</span><span class="hl-1">;</span><br/><span class="hl-1">}).</span><span class="hl-0">toThrow</span><span class="hl-1">(</span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">TypeError</span><span class="hl-1">(</span><span class="hl-2">`Invalid value, expected 0xDEADBEEF`</span><span class="hl-1">));</span><br/><br/><span class="hl-5">// ... but</span><br/><span class="hl-7">req</span><span class="hl-1">.</span><span class="hl-7">header</span><span class="hl-1"> = </span><span class="hl-8">0xDEADBEEF</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<a id="md:enumerated-fields-typescript" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Enumerated fields (Typescript)<a href="#md:enumerated-fields-typescript" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">Struct</span><span class="hl-1">, </span><span class="hl-7">typed</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;typed-struct&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">enum</span><span class="hl-1"> </span><span class="hl-9">ErrorType</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">Success</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">Timeout</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">InvalidCommand</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">ServerError</span><span class="hl-1">,</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">REQUEST</span><span class="hl-1"> = </span><span class="hl-8">0xAA</span><span class="hl-1">;</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">RESPONSE</span><span class="hl-1"> = </span><span class="hl-8">0x55</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Numeric type refinement</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">OperationResult</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">()</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt8</span><span class="hl-1">(</span><span class="hl-2">&#39;operation&#39;</span><span class="hl-1">, </span><span class="hl-7">typed</span><span class="hl-1">&lt;</span><span class="hl-8">1</span><span class="hl-1"> | </span><span class="hl-8">2</span><span class="hl-1"> | </span><span class="hl-8">3</span><span class="hl-1"> | </span><span class="hl-8">19</span><span class="hl-1">&gt;())</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt8</span><span class="hl-1">(</span><span class="hl-2">&#39;type&#39;</span><span class="hl-1">, </span><span class="hl-0">typed</span><span class="hl-1">&lt;</span><span class="hl-3">typeof</span><span class="hl-1"> </span><span class="hl-4">REQUEST</span><span class="hl-1"> | </span><span class="hl-3">typeof</span><span class="hl-1"> </span><span class="hl-4">RESPONSE</span><span class="hl-1">&gt;())</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt8</span><span class="hl-1">(</span><span class="hl-2">&#39;error&#39;</span><span class="hl-1">, </span><span class="hl-0">typed</span><span class="hl-1">&lt;</span><span class="hl-9">ErrorType</span><span class="hl-1">&gt;())</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-5">/*</span><br/><span class="hl-5">type OperationResult = {</span><br/><span class="hl-5">  operation: 1 | 2 | 3 | 19;</span><br/><span class="hl-5">  type: 0xAA | 0x55;</span><br/><span class="hl-5">  error: ErrorType;</span><br/><span class="hl-5">}</span><br/><span class="hl-5">*/</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">OperationResult</span><span class="hl-1">();</span><br/><span class="hl-7">res</span><span class="hl-1">.</span><span class="hl-7">error</span><span class="hl-1"> = </span><span class="hl-7">ErrorType</span><span class="hl-1">.</span><span class="hl-7">Success</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<a id="md:variable-length-structures" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Variable length structures<a href="#md:variable-length-structures" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Package</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Package&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;length&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">// If you do not specify the length of the buffer,</span><br/><span class="hl-1">  </span><span class="hl-5">// it will take all the remaining space.</span><br/><span class="hl-1">  </span><span class="hl-5">// There can only be one such field, and it must be the last.</span><br/><span class="hl-1">  </span><span class="hl-5">// You can specify a negative buffer length (-N),</span><br/><span class="hl-1">  </span><span class="hl-5">// then the buffer will take up all space except for the last N bytes</span><br/><span class="hl-1">  </span><span class="hl-5">// Since the size of the buffer is unknown, `baseSize` ignores its length.</span><br/><span class="hl-1">  .</span><span class="hl-0">Buffer</span><span class="hl-1">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Package</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">2</span><span class="hl-1">);</span><br/><br/><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">createPackage</span><span class="hl-1">(</span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-9">Buffer</span><span class="hl-1">): </span><span class="hl-9">Package</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">pkg</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Package</span><span class="hl-1">(</span><span class="hl-7">Package</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1"> + </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-0">copy</span><span class="hl-1">(</span><span class="hl-7">pkg</span><span class="hl-1">.</span><span class="hl-7">data</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">pkg</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> = </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-7">pkg</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:crc" class="tsd-anchor"></a><h3 class="tsd-anchor-link">CRC<a href="#md:crc" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The checksum is often used to verify data integrity,
it is usually stored in the last bytes of the buffer.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Exact</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Exact&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;length&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Buffer</span><span class="hl-1">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">// Only the checksum can go after the tail buffer</span><br/><span class="hl-1">  .</span><span class="hl-0">CRC16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;crc&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Exact</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">4</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>If you pass the checksum function as parameters, then your structure will have the static <code>crc</code> method that you can use to calculate and update this field.</p>
<p>Let's slightly modify the previous example:</p>
<pre><code class="ts"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">crc16</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;crc&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Exact</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Exact&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;length&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Buffer</span><span class="hl-1">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">// checksum function and initial value</span><br/><span class="hl-1">  .</span><span class="hl-0">CRC16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;crc&#39;</span><span class="hl-1">, </span><span class="hl-7">crc16</span><span class="hl-1">, </span><span class="hl-8">0xffff</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">createExact</span><span class="hl-1">(</span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-9">Buffer</span><span class="hl-1">): </span><span class="hl-9">Exact</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">item</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Exact</span><span class="hl-1">(</span><span class="hl-7">Exact</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1"> + </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-0">copy</span><span class="hl-1">(</span><span class="hl-7">item</span><span class="hl-1">.</span><span class="hl-7">data</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">item</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> = </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">// New static method `Exact.crc`</span><br/><span class="hl-1">  </span><span class="hl-7">item</span><span class="hl-1">.</span><span class="hl-7">crc</span><span class="hl-1"> = </span><span class="hl-7">Exact</span><span class="hl-1">.</span><span class="hl-0">crc</span><span class="hl-1">(</span><span class="hl-7">item</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-5">// or the same thing - calculate and update the field</span><br/><span class="hl-1">  </span><span class="hl-7">Exact</span><span class="hl-1">.</span><span class="hl-0">crc</span><span class="hl-1">(</span><span class="hl-7">item</span><span class="hl-1">, </span><span class="hl-3">true</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-7">item</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:strings" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Strings<a href="#md:strings" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Person</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Person&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">String</span><span class="hl-1">(</span><span class="hl-2">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-8">30</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">String</span><span class="hl-1">(</span><span class="hl-2">&#39;surname&#39;</span><span class="hl-1">, </span><span class="hl-8">40</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Person</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">70</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">walterGreen</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Person</span><span class="hl-1">();</span><br/><span class="hl-7">walterGreen</span><span class="hl-1">.</span><span class="hl-7">name</span><span class="hl-1"> = </span><span class="hl-2">&#39;Walter&#39;</span><span class="hl-1">;</span><br/><span class="hl-7">walterGreen</span><span class="hl-1">.</span><span class="hl-7">surname</span><span class="hl-1"> = </span><span class="hl-2">&#39;Green&#39;</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>You can specify the encoding, the default is UTF8.
You can use the encodings supported by <a href="https://nodejs.org/dist/latest-v16.x/docs/api/buffer.html#buffer_buffers_and_character_encodings"><code>Buffer</code></a>
or install <a href="https://github.com/ashtuchkin/iconv-lite">iconv-lite</a> package
to add support for all encodings defined in this package.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Foo</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Foo&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">// Specify the desired encoding and size in bytes like this</span><br/><span class="hl-1">  .</span><span class="hl-0">String</span><span class="hl-1">(</span><span class="hl-2">&#39;bar&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;win1251&#39;</span><span class="hl-1">, </span><span class="hl-8">10</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">// or so</span><br/><span class="hl-1">  .</span><span class="hl-0">String</span><span class="hl-1">(</span><span class="hl-2">&#39;baz&#39;</span><span class="hl-1">, </span><span class="hl-8">10</span><span class="hl-1">, </span><span class="hl-2">&#39;ucs2&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">// or even so</span><br/><span class="hl-1">  .</span><span class="hl-0">String</span><span class="hl-1">(</span><span class="hl-2">&#39;quux&#39;</span><span class="hl-1">, { </span><span class="hl-7">length:</span><span class="hl-1"> </span><span class="hl-8">10</span><span class="hl-1">, </span><span class="hl-7">encoding:</span><span class="hl-1"> </span><span class="hl-2">&#39;koi8-r&#39;</span><span class="hl-1">, </span><span class="hl-7">literal:</span><span class="hl-1"> </span><span class="hl-2">&#39;Андрей&#39;</span><span class="hl-1"> })</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>If you do not specify the length, then the <code>string field</code> will take up all the remaining space.</p>
<a id="md:string-arrays" class="tsd-anchor"></a><h3 class="tsd-anchor-link">String Arrays<a href="#md:string-arrays" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Page</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Page&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">StringArray</span><span class="hl-1">(</span><span class="hl-2">&#39;body&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-7">length:</span><span class="hl-1"> </span><span class="hl-8">80</span><span class="hl-1">,        </span><span class="hl-5">// string length in bytes (required)</span><br/><span class="hl-1">    </span><span class="hl-7">lines:</span><span class="hl-1"> </span><span class="hl-8">25</span><span class="hl-1">,         </span><span class="hl-5">// number of lines (required)</span><br/><span class="hl-1">    </span><span class="hl-7">encoding:</span><span class="hl-1"> </span><span class="hl-2">&#39;ascii&#39;</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">page</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Page</span><span class="hl-1">();</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Page</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">80</span><span class="hl-1"> * </span><span class="hl-8">25</span><span class="hl-1">);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Array</span><span class="hl-1">.</span><span class="hl-0">isArray</span><span class="hl-1">(</span><span class="hl-7">page</span><span class="hl-1">.</span><span class="hl-7">body</span><span class="hl-1">)).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-3">true</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">body</span><span class="hl-1"> = </span><span class="hl-7">page</span><span class="hl-1">.</span><span class="hl-7">body</span><span class="hl-1">;</span><br/><span class="hl-7">body</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">] = </span><span class="hl-2">&#39;Lorem ipsum&#39;</span><span class="hl-1">;</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">page</span><span class="hl-1">.</span><span class="hl-7">body</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">]).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-7">body</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">]);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">raw</span><span class="hl-1"> = </span><span class="hl-7">Page</span><span class="hl-1">.</span><span class="hl-0">raw</span><span class="hl-1">(</span><span class="hl-7">page</span><span class="hl-1">);</span><br/><span class="hl-7">raw</span><span class="hl-1">[</span><span class="hl-7">Page</span><span class="hl-1">.</span><span class="hl-0">getOffsetOf</span><span class="hl-1">(</span><span class="hl-2">&#39;body&#39;</span><span class="hl-1">)] = </span><span class="hl-2">&#39;l&#39;</span><span class="hl-1">.</span><span class="hl-0">charCodeAt</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">body</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">]).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-2">&#39;lorem ipsum&#39;</span><span class="hl-1">);</span><br/><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">page</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>output</p>
<pre><code><span class="hl-7">Page</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">body</span><span class="hl-1">: [</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;lorem ipsum&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,            </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,            </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,            </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,            </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,            </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,            </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,            </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">&#39;&#39;</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<a id="md:bit-fields" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Bit fields<a href="#md:bit-fields" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-5">// |------&gt; bit order from the most significant bits to the least significant</span><br/><span class="hl-5">// 01234567 offset</span><br/><span class="hl-5">// 00011110 mask</span><br/><span class="hl-5">//    \  /</span><br/><span class="hl-5">//     \/</span><br/><span class="hl-5">// bit field with an offset of 3 bits and a length of 4 bits</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Foo</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Foo&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Bits8</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-5">// for each property, specify the offset and length</span><br/><span class="hl-1">    </span><span class="hl-7">high:</span><span class="hl-1"> [</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-8">4</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-7">low:</span><span class="hl-1"> [</span><span class="hl-8">4</span><span class="hl-1">, </span><span class="hl-8">4</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-5">// properties may overlap</span><br/><span class="hl-1">    </span><span class="hl-7">value:</span><span class="hl-1"> [</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-8">8</span><span class="hl-1">]</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Foo</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">1</span><span class="hl-1">);</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">foo</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Foo</span><span class="hl-1">();</span><br/><span class="hl-7">foo</span><span class="hl-1">.</span><span class="hl-7">value</span><span class="hl-1"> = </span><span class="hl-8">0x36</span><span class="hl-1">;</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">foo</span><span class="hl-1">.</span><span class="hl-7">high</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">3</span><span class="hl-1">);</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">foo</span><span class="hl-1">.</span><span class="hl-7">low</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">6</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:reserved-fields" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Reserved fields<a href="#md:reserved-fields" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Bar</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Bar&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Int16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;baz&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-5">// Skip two bytes.</span><br/><span class="hl-1">  </span><span class="hl-5">// You can use negative values for unions.</span><br/><span class="hl-1">  </span><span class="hl-5">// Zero moves the current pointer to the end.</span><br/><span class="hl-1">  .</span><span class="hl-0">seek</span><span class="hl-1">(</span><span class="hl-8">2</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-7">Bar</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-8">4</span><span class="hl-1">);  </span>
</code><button type="button">Copy</button></pre>

<a id="md:json" class="tsd-anchor"></a><h3 class="tsd-anchor-link">JSON<a href="#md:json" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>e.g.</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Model</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Model&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Int8</span><span class="hl-1">(</span><span class="hl-2">&#39;foo&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt8Array</span><span class="hl-1">(</span><span class="hl-2">&#39;bars&#39;</span><span class="hl-1">, </span><span class="hl-8">4</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;nested&#39;</span><span class="hl-1">, </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Nested&#39;</span><span class="hl-1">).</span><span class="hl-0">Int8</span><span class="hl-1">(</span><span class="hl-2">&#39;value&#39;</span><span class="hl-1">).</span><span class="hl-0">Buffer</span><span class="hl-1">(</span><span class="hl-2">&#39;items&#39;</span><span class="hl-1">, </span><span class="hl-8">4</span><span class="hl-1">).</span><span class="hl-0">compile</span><span class="hl-1">())</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Model</span><span class="hl-1">([</span><span class="hl-8">0x10</span><span class="hl-1">, </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">, </span><span class="hl-8">3</span><span class="hl-1">, </span><span class="hl-8">4</span><span class="hl-1">, </span><span class="hl-8">0x20</span><span class="hl-1">, </span><span class="hl-8">5</span><span class="hl-1">, </span><span class="hl-8">6</span><span class="hl-1">, </span><span class="hl-8">7</span><span class="hl-1">, </span><span class="hl-8">8</span><span class="hl-1">]);</span>
</code><button type="button">Copy</button></pre>

<p>Let's see what the <code>model</code> is <sup><a href="#md:note">[note*]</a></sup></p>
<pre><code class="ts"><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">model</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>output: (<code>$raw</code> is a hidden property and is shown for clarity)</p>
<pre><code><span class="hl-7">Model</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">foo</span><span class="hl-1">: [</span><span class="hl-7">Getter</span><span class="hl-1">/</span><span class="hl-7">Setter</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-10">bars</span><span class="hl-1">: </span><span class="hl-0">Uint8Array</span><span class="hl-1">(</span><span class="hl-8">4</span><span class="hl-1">) [ </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">, </span><span class="hl-8">3</span><span class="hl-1">, </span><span class="hl-8">4</span><span class="hl-1"> ],</span><br/><span class="hl-1">  </span><span class="hl-10">nested</span><span class="hl-1">: </span><span class="hl-7">Nested</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">value</span><span class="hl-1">: [</span><span class="hl-7">Getter</span><span class="hl-1">/</span><span class="hl-7">Setter</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-10">items</span><span class="hl-1">: &lt;</span><span class="hl-9">Buffer</span><span class="hl-1"> </span><span class="hl-8">05</span><span class="hl-1"> </span><span class="hl-8">06</span><span class="hl-1"> </span><span class="hl-8">07</span><span class="hl-1"> </span><span class="hl-8">08</span><span class="hl-1">&gt;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-10">$raw</span><span class="hl-1">: &lt;</span><span class="hl-9">Buffer</span><span class="hl-1"> </span><span class="hl-8">10</span><span class="hl-1"> </span><span class="hl-8">01</span><span class="hl-1"> </span><span class="hl-8">02</span><span class="hl-1"> </span><span class="hl-8">03</span><span class="hl-1"> </span><span class="hl-8">04</span><span class="hl-1"> </span><span class="hl-8">20</span><span class="hl-1"> </span><span class="hl-8">05</span><span class="hl-1"> </span><span class="hl-8">06</span><span class="hl-1"> </span><span class="hl-8">07</span><span class="hl-1"> </span><span class="hl-8">08</span><span class="hl-1">&gt;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<p>If you only need a parser, you can avoid overheads like getters and setters
and hidden buffers by using the method <code>toJSON</code>. The result contains only data,
as opposed to methods or internal state. Its <code>prototype</code> is <code>Object.prototype</code>
and all numeric iterable types (buffer, typed arrays) are replaced with <code>number[]</code>,
all custom types other than <code>number</code>, <code>boolean</code>, <code>string</code>, <code>string[]</code> and numeric
iterables are replaced with the result of executing <code>toJSON</code> or <code>toString</code> methods.</p>
<pre><code class="ts"><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-7">model</span><span class="hl-1">.</span><span class="hl-0">toJSON</span><span class="hl-1">());</span>
</code><button type="button">Copy</button></pre>

<p>output:</p>
<pre><code><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">foo</span><span class="hl-1">: </span><span class="hl-8">16</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">bars</span><span class="hl-1">: [ </span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-8">2</span><span class="hl-1">, </span><span class="hl-8">3</span><span class="hl-1">, </span><span class="hl-8">4</span><span class="hl-1"> ],</span><br/><span class="hl-1">  </span><span class="hl-10">nested</span><span class="hl-1">: { </span><span class="hl-10">value</span><span class="hl-1">: </span><span class="hl-8">32</span><span class="hl-1">, </span><span class="hl-10">items</span><span class="hl-1">: [ </span><span class="hl-8">5</span><span class="hl-1">, </span><span class="hl-8">6</span><span class="hl-1">, </span><span class="hl-8">7</span><span class="hl-1">, </span><span class="hl-8">8</span><span class="hl-1"> ] }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

<br/>
<a id="md:note" class="tsd-anchor"></a><h5 class="tsd-anchor-link">Note:<a href="#md:note" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><blockquote>
<p>Starting from version 2.3.0 in the environment of node.js, the expression
<code>console.log(model)</code> behaves the same as <code>console.log(model.toJSON())</code>.
This is done to make debugging easier.</p>
</blockquote>
<a id="md:tostring" class="tsd-anchor"></a><h3 class="tsd-anchor-link">toString()<a href="#md:tostring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For ease of debugging, the generated structures have an overridden <code>toString</code> method
that outputs a string of hexadecimal bytes separated by an equals sign at field boundaries.
If there is a <a href="https://www.npmjs.com/package/debug">debug</a> package in the dependencies, then these fields will be colored
depending on the field name.</p>
<blockquote>
<p>console.log(<code>${model}</code>);</p>
<p><span style="color:lightblue">01</span>=<span style="color: lightgreen">ce-ca-23-00-00-00-00-00</span>=<span style="color: orange">ff-ff-ff-ff-ff-ff</span></p>
</blockquote>
<a id="md:a-typical-example-of-working-with-binary-data-via-a-serial-port" class="tsd-anchor"></a><h3 class="tsd-anchor-link">A typical example of working with binary data via a serial port<a href="#md:a-typical-example-of-working-with-binary-data-via-a-serial-port" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Package.ts</p>
<pre><code class="ts"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">Struct</span><span class="hl-1">, </span><span class="hl-7">typed</span><span class="hl-1">, </span><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-7">ExtractType</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;typed-struct&#39;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">crc16</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;crc&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">enum</span><span class="hl-1"> </span><span class="hl-9">Command</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">Read</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">Write</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">Reset</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">Halt</span><span class="hl-1">,</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">PREAMBLE</span><span class="hl-1"> = </span><span class="hl-8">0x1234</span><span class="hl-1">;</span><br/><br/><span class="hl-5">/**</span><br/><span class="hl-5"> * Variable length structure </span><br/><span class="hl-5"> * Package.baseSize = 9 - minimal structure size</span><br/><span class="hl-5"> */</span><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">Package</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Struct</span><span class="hl-1">(</span><span class="hl-2">&#39;Package&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt16BE</span><span class="hl-1">(</span><span class="hl-2">&#39;header&#39;</span><span class="hl-1">, </span><span class="hl-4">PREAMBLE</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt8</span><span class="hl-1">(</span><span class="hl-2">&#39;source&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt8</span><span class="hl-1">(</span><span class="hl-2">&#39;destination&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt8</span><span class="hl-1">(</span><span class="hl-2">&#39;command&#39;</span><span class="hl-1">, </span><span class="hl-0">typed</span><span class="hl-1">&lt;</span><span class="hl-9">Command</span><span class="hl-1">&gt;())</span><br/><span class="hl-1">  .</span><span class="hl-0">UInt16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;length&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">Buffer</span><span class="hl-1">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">CRC16LE</span><span class="hl-1">(</span><span class="hl-2">&#39;crc&#39;</span><span class="hl-1">, </span><span class="hl-7">crc16</span><span class="hl-1">)</span><br/><span class="hl-1">  .</span><span class="hl-0">compile</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// it&#39;s not obligatory</span><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-3">type</span><span class="hl-1"> </span><span class="hl-9">Package</span><span class="hl-1"> = </span><span class="hl-9">ExtractType</span><span class="hl-1">&lt;</span><span class="hl-3">typeof</span><span class="hl-1"> </span><span class="hl-7">Package</span><span class="hl-1">&gt;;</span><br/><span class="hl-5">/*</span><br/><span class="hl-5">type Package = {</span><br/><span class="hl-5">  header: 0x1234;</span><br/><span class="hl-5">  source: number;</span><br/><span class="hl-5">  destination: number;</span><br/><span class="hl-5">  command: Command;</span><br/><span class="hl-5">  length: number;</span><br/><span class="hl-5">  data: Buffer;</span><br/><span class="hl-5">  crc: number;</span><br/><span class="hl-5">}</span><br/><span class="hl-5"> */</span>
</code><button type="button">Copy</button></pre>

<p>Decoder.ts</p>
<pre><code class="ts"><span class="hl-6">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">Transform</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">TransformOptions</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">TransformCallback</span><br/><span class="hl-1">} </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;stream&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">Package</span><span class="hl-1">, </span><span class="hl-7">PREAMBLE</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./Package&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">preamble</span><span class="hl-1"> = </span><span class="hl-7">Buffer</span><span class="hl-1">.</span><span class="hl-0">alloc</span><span class="hl-1">(</span><span class="hl-8">2</span><span class="hl-1">);</span><br/><span class="hl-7">preamble</span><span class="hl-1">.</span><span class="hl-0">writeInt16BE</span><span class="hl-1">(</span><span class="hl-4">PREAMBLE</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">empty</span><span class="hl-1"> = </span><span class="hl-7">Buffer</span><span class="hl-1">.</span><span class="hl-0">alloc</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">);</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">lengthOffset</span><span class="hl-1"> = </span><span class="hl-7">Package</span><span class="hl-1">.</span><span class="hl-0">getOffsetOf</span><span class="hl-1">(</span><span class="hl-2">&#39;length&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-6">default</span><span class="hl-1"> </span><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-9">Decoder</span><span class="hl-1"> </span><span class="hl-3">extends</span><span class="hl-1"> </span><span class="hl-9">Transform</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">private</span><span class="hl-1"> </span><span class="hl-7">buf</span><span class="hl-1"> = </span><span class="hl-7">empty</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-3">constructor</span><span class="hl-1">(</span><span class="hl-7">options</span><span class="hl-1">?: </span><span class="hl-9">TransformOptions</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">super</span><span class="hl-1">({</span><br/><span class="hl-1">      ...</span><span class="hl-7">options</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">readableObjectMode:</span><span class="hl-1"> </span><span class="hl-3">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-0">_transform</span><span class="hl-1">(</span><span class="hl-7">chunk</span><span class="hl-1">: </span><span class="hl-9">unknown</span><span class="hl-1">, </span><span class="hl-7">encoding</span><span class="hl-1">: </span><span class="hl-9">BufferEncoding</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">: </span><span class="hl-9">TransformCallback</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">Buffer</span><span class="hl-1">.</span><span class="hl-0">isBuffer</span><span class="hl-1">(</span><span class="hl-7">chunk</span><span class="hl-1">)) {</span><br/><span class="hl-1">      </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">data</span><span class="hl-1"> = </span><span class="hl-7">Buffer</span><span class="hl-1">.</span><span class="hl-0">concat</span><span class="hl-1">([</span><span class="hl-3">this</span><span class="hl-1">.</span><span class="hl-7">buf</span><span class="hl-1">, </span><span class="hl-7">chunk</span><span class="hl-1">]);</span><br/><span class="hl-1">      </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">this</span><span class="hl-1">.</span><span class="hl-7">buf</span><span class="hl-1"> = </span><span class="hl-3">this</span><span class="hl-1">.</span><span class="hl-0">recognize</span><span class="hl-1">(</span><span class="hl-7">data</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">callback</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-0">_flush</span><span class="hl-1">(</span><span class="hl-7">callback</span><span class="hl-1">: </span><span class="hl-9">TransformCallback</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">this</span><span class="hl-1">.</span><span class="hl-7">buf</span><span class="hl-1"> = </span><span class="hl-7">empty</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">callback</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">private</span><span class="hl-1"> </span><span class="hl-0">recognize</span><span class="hl-1">(</span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-9">Buffer</span><span class="hl-1">): </span><span class="hl-9">Buffer</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">for</span><span class="hl-1"> (</span><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-7">offset</span><span class="hl-1"> = </span><span class="hl-8">0</span><span class="hl-1">;;) {</span><br/><span class="hl-1">      </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">rest</span><span class="hl-1"> = </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> - </span><span class="hl-7">offset</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">rest</span><span class="hl-1"> &lt;= </span><span class="hl-8">0</span><span class="hl-1">) </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-7">empty</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">start</span><span class="hl-1"> = </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-0">indexOf</span><span class="hl-1">(</span><span class="hl-7">rest</span><span class="hl-1"> &lt; </span><span class="hl-7">preamble</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> ? </span><span class="hl-7">preamble</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-7">rest</span><span class="hl-1">) : </span><span class="hl-7">preamble</span><span class="hl-1">, </span><span class="hl-7">offset</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">start</span><span class="hl-1"> === -</span><span class="hl-8">1</span><span class="hl-1">) </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-7">empty</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">frame</span><span class="hl-1"> = </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-7">start</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">frame</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> &lt; </span><span class="hl-7">Package</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">) </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-7">frame</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">length</span><span class="hl-1"> = </span><span class="hl-7">frame</span><span class="hl-1">.</span><span class="hl-0">readUInt16LE</span><span class="hl-1">(</span><span class="hl-7">lengthOffset</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">length</span><span class="hl-1"> &lt;= </span><span class="hl-4">MAX_LENGTH</span><span class="hl-1">) {</span><br/><br/><span class="hl-1">        </span><span class="hl-5">// calculate the total size of structure</span><br/><span class="hl-1">        </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">total</span><span class="hl-1"> = </span><span class="hl-7">length</span><span class="hl-1"> + </span><span class="hl-7">Package</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">frame</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> &lt; </span><span class="hl-7">total</span><span class="hl-1">) </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-7">frame</span><span class="hl-1">;</span><br/><br/><span class="hl-1">        </span><span class="hl-5">// deserialize Package from the buffer</span><br/><span class="hl-1">        </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">pkg</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Package</span><span class="hl-1">(</span><span class="hl-7">frame</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-7">total</span><span class="hl-1">));</span><br/><br/><span class="hl-1">        </span><span class="hl-5">// crc check</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">Package</span><span class="hl-1">.</span><span class="hl-0">crc</span><span class="hl-1">(</span><span class="hl-7">pkg</span><span class="hl-1">) === </span><span class="hl-7">pkg</span><span class="hl-1">.</span><span class="hl-7">crc</span><span class="hl-1">) {</span><br/><br/><span class="hl-1">          </span><span class="hl-5">// push decoded package</span><br/><span class="hl-1">          </span><span class="hl-3">this</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-7">pkg</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-7">offset</span><span class="hl-1"> = </span><span class="hl-7">start</span><span class="hl-1"> + </span><span class="hl-7">total</span><span class="hl-1">;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">offset</span><span class="hl-1"> &lt;= </span><span class="hl-7">start</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">offset</span><span class="hl-1"> = </span><span class="hl-7">start</span><span class="hl-1"> + </span><span class="hl-8">1</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Encoder.ts</p>
<pre><code class="ts"><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">Transform</span><span class="hl-1">, </span><span class="hl-7">TransformCallback</span><span class="hl-1">, </span><span class="hl-7">TransformOptions</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;stream&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">Package</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./Package&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-6">default</span><span class="hl-1"> </span><span class="hl-3">class</span><span class="hl-1"> </span><span class="hl-9">Encoder</span><span class="hl-1"> </span><span class="hl-3">extends</span><span class="hl-1"> </span><span class="hl-9">Transform</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">constructor</span><span class="hl-1">(</span><span class="hl-7">options</span><span class="hl-1">?: </span><span class="hl-9">TransformOptions</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">super</span><span class="hl-1">({</span><br/><span class="hl-1">      ...</span><span class="hl-7">options</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-7">writableObjectMode:</span><span class="hl-1"> </span><span class="hl-3">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">public</span><span class="hl-1"> </span><span class="hl-0">_transform</span><span class="hl-1">(</span><span class="hl-7">chunk</span><span class="hl-1">: </span><span class="hl-9">unknown</span><span class="hl-1">, </span><span class="hl-7">encoding</span><span class="hl-1">: </span><span class="hl-9">BufferEncoding</span><span class="hl-1">, </span><span class="hl-7">callback</span><span class="hl-1">: </span><span class="hl-9">TransformCallback</span><span class="hl-1">): </span><span class="hl-9">void</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">chunks</span><span class="hl-1"> = </span><span class="hl-7">Array</span><span class="hl-1">.</span><span class="hl-0">isArray</span><span class="hl-1">(</span><span class="hl-7">chunk</span><span class="hl-1">) ? </span><span class="hl-7">chunk</span><span class="hl-1"> : [</span><span class="hl-7">chunk</span><span class="hl-1">];</span><br/><span class="hl-1">    </span><span class="hl-7">chunks</span><span class="hl-1">.</span><span class="hl-0">forEach</span><span class="hl-1">(</span><span class="hl-7">pkg</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><br/><span class="hl-1">      </span><span class="hl-5">// instance type check</span><br/><span class="hl-1">      </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">pkg</span><span class="hl-1"> </span><span class="hl-3">instanceof</span><span class="hl-1"> </span><span class="hl-9">Package</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// getting a raw buffer</span><br/><span class="hl-1">        </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">raw</span><span class="hl-1"> = </span><span class="hl-7">Package</span><span class="hl-1">.</span><span class="hl-0">raw</span><span class="hl-1">(</span><span class="hl-7">pkg</span><span class="hl-1">);</span><br/><br/><span class="hl-1">        </span><span class="hl-5">// update length</span><br/><span class="hl-1">        </span><span class="hl-7">pkg</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> = </span><span class="hl-7">pkg</span><span class="hl-1">.</span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1">;</span><br/><br/><span class="hl-1">        </span><span class="hl-5">// update crc</span><br/><span class="hl-1">        </span><span class="hl-7">Package</span><span class="hl-1">.</span><span class="hl-0">crc</span><span class="hl-1">(</span><span class="hl-7">pkg</span><span class="hl-1">, </span><span class="hl-3">true</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><br/><span class="hl-1">        </span><span class="hl-5">// serialize</span><br/><span class="hl-1">        </span><span class="hl-3">this</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-7">raw</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">callback</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>serial.ts</p>
<pre><code class="ts"><span class="hl-6">import</span><span class="hl-1"> </span><span class="hl-7">pump</span><span class="hl-1"> </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;pump&#39;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> </span><span class="hl-7">SerialPort</span><span class="hl-1"> </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;serialport&#39;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> </span><span class="hl-7">Decoder</span><span class="hl-1"> </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./Decoder&#39;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> </span><span class="hl-7">Encoder</span><span class="hl-1"> </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./Encoder&#39;</span><span class="hl-1">;</span><br/><span class="hl-6">import</span><span class="hl-1"> { </span><span class="hl-7">Package</span><span class="hl-1">, </span><span class="hl-7">Command</span><span class="hl-1"> } </span><span class="hl-6">from</span><span class="hl-1"> </span><span class="hl-2">&#39;./Package&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// ...</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">decoder</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Decoder</span><span class="hl-1">();</span><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">encoder</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Encoder</span><span class="hl-1">();</span><br/><span class="hl-3">let</span><span class="hl-1"> </span><span class="hl-7">connected</span><span class="hl-1"> = </span><span class="hl-3">false</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">serial</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">SerialPort</span><span class="hl-1">(</span><span class="hl-7">path</span><span class="hl-1">, { </span><span class="hl-7">baudRate:</span><span class="hl-1"> </span><span class="hl-8">115200</span><span class="hl-1"> }, </span><span class="hl-7">err</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-7">err</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`error while open </span><span class="hl-3">${</span><span class="hl-7">path</span><span class="hl-3">}</span><span class="hl-2">`</span><span class="hl-1">)</span><br/><span class="hl-1">  } </span><span class="hl-6">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// create a pipeline</span><br/><span class="hl-1">    </span><span class="hl-0">pump</span><span class="hl-1">(</span><span class="hl-7">encoder</span><span class="hl-1">, </span><span class="hl-7">serial</span><span class="hl-1">, </span><span class="hl-7">decoder</span><span class="hl-1">, </span><span class="hl-7">err</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">connected</span><span class="hl-1"> = </span><span class="hl-3">false</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-7">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;pipe finished&#39;</span><span class="hl-1">, </span><span class="hl-7">err</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-7">connected</span><span class="hl-1"> = </span><span class="hl-3">true</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">decoder</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-7">res</span><span class="hl-1">: </span><span class="hl-9">Package</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Processing the package</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Example function for sending data</span><br/><span class="hl-3">async</span><span class="hl-1"> </span><span class="hl-3">function</span><span class="hl-1"> </span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-7">data</span><span class="hl-1">: </span><span class="hl-9">Buffer</span><span class="hl-1">, </span><span class="hl-7">src</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">, </span><span class="hl-7">dest</span><span class="hl-1">: </span><span class="hl-9">number</span><span class="hl-1">): </span><span class="hl-9">Promise</span><span class="hl-1">&lt;</span><span class="hl-9">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-7">connected</span><span class="hl-1">) </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Connection closed&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Create a packet with the specified buffer size</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-4">pkg</span><span class="hl-1"> = </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-0">Package</span><span class="hl-1">(</span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-7">length</span><span class="hl-1"> + </span><span class="hl-7">Package</span><span class="hl-1">.</span><span class="hl-7">baseSize</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Package initialization</span><br/><span class="hl-1">  </span><span class="hl-7">data</span><span class="hl-1">.</span><span class="hl-0">copy</span><span class="hl-1">(</span><span class="hl-7">pkg</span><span class="hl-1">.</span><span class="hl-7">data</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-7">pkg</span><span class="hl-1">.</span><span class="hl-7">source</span><span class="hl-1"> = </span><span class="hl-7">src</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">pkg</span><span class="hl-1">.</span><span class="hl-7">destination</span><span class="hl-1"> = </span><span class="hl-7">dest</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-7">pkg</span><span class="hl-1">.</span><span class="hl-7">command</span><span class="hl-1"> = </span><span class="hl-7">Command</span><span class="hl-1">.</span><span class="hl-7">Write</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><br/><span class="hl-1">  </span><span class="hl-5">// Sending a package</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-7">encoder</span><span class="hl-1">.</span><span class="hl-0">write</span><span class="hl-1">(</span><span class="hl-7">pkg</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-3">new</span><span class="hl-1"> </span><span class="hl-9">Promise</span><span class="hl-1">(</span><span class="hl-7">resolve</span><span class="hl-1"> </span><span class="hl-3">=&gt;</span><span class="hl-1"> </span><span class="hl-7">encoder</span><span class="hl-1">.</span><span class="hl-0">once</span><span class="hl-1">(</span><span class="hl-2">&#39;drain&#39;</span><span class="hl-1">, </span><span class="hl-7">resolve</span><span class="hl-1">));</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-0">release</span><span class="hl-1"> = () </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">serial</span><span class="hl-1">.</span><span class="hl-7">isOpen</span><span class="hl-1"> &amp;&amp; </span><span class="hl-7">serial</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><span class="hl-7">process</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;SIGINT&#39;</span><span class="hl-1">, </span><span class="hl-7">release</span><span class="hl-1">);</span><br/><span class="hl-7">process</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;SIGTERM&#39;</span><span class="hl-1">, </span><span class="hl-7">release</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#md:license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This project is licensed under the MIT License - see the <a href="media/LICENSE">LICENSE</a> file for details</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:typed-struct"><span>typed-<wbr/>struct</span></a><ul><li><a href="#md:getting-started"><span>Getting started</span></a></li><li><a href="#md:features"><span>Features</span></a></li><li><a href="#md:api"><span>API</span></a></li><li><a href="#md:examples"><span>Examples</span></a></li><li><ul><li><a href="#md:create-a-data-structure-by-chaining-the-appropriate-method-calls"><span>Create a data structure by chaining the appropriate method calls</span></a></li><li><a href="#md:typed-arrays"><span>Typed arrays</span></a></li><li><a href="#md:array-of-structures"><span>Array of structures</span></a></li><li><a href="#md:nested-types"><span>Nested types</span></a></li><li><a href="#md:unions"><span>Unions</span></a></li><li><a href="#md:custom-types"><span>Custom types</span></a></li><li><a href="#md:aliases"><span>Aliases</span></a></li><li><a href="#md:fixed-values"><span>Fixed values</span></a></li><li><a href="#md:enumerated-fields-typescript"><span>Enumerated fields (<wbr/>Typescript)</span></a></li><li><a href="#md:variable-length-structures"><span>Variable length structures</span></a></li><li><a href="#md:crc"><span>CRC</span></a></li><li><a href="#md:strings"><span>Strings</span></a></li><li><a href="#md:string-arrays"><span>String <wbr/>Arrays</span></a></li><li><a href="#md:bit-fields"><span>Bit fields</span></a></li><li><a href="#md:reserved-fields"><span>Reserved fields</span></a></li><li><a href="#md:json"><span>JSON</span></a></li><li><ul><li><ul><li><a href="#md:note"><span>Note:</span></a></li></ul></li></ul></li><li><a href="#md:tostring"><span>to<wbr/>String()</span></a></li><li><a href="#md:a-typical-example-of-working-with-binary-data-via-a-serial-port"><span>A typical example of working with binary data via a serial port</span></a></li></ul></li><li><a href="#md:license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>typed-struct</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
